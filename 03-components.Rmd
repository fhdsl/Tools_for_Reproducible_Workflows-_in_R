
# Components of a reproducible analysis

```{r, include = FALSE}
ottrpal::set_knitr_image_path()
```

In this chapter, we will discuss what components of an analysis make it reproducible.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Major point!! example image"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g21a84b32106_0_23")
```

## Reproducibility is iterative work

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Major point!! example image"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g21a84b32106_0_23")
```

## Components of reproducibility
A reproducible analysis is transparent, consistent, and accessible.

- **Transparency** refers to the idea that it is well communicated and everything is displayed: data, code, goals, methods, and decisions. There are no secrets in a reproducible analysis/
- **Consistency** refers to the idea that the code can be consistently run, but also everything follows a particular system, conventions and design.
- **Accessibility** refers to the idea that anyone anywhere should be able to run and/or examine the analysis. No pay walls or expensive software should be required.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Major point!! example image"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g21b8e34c516_0_5")
```

## Transparent

Code that runs reliably is important but clear communication about the analysis and the decisions made make an analysis reproducible. A transparent analysis is not only well communicated, but also shared publicly in a way that others can comment and contribute ideas and suggestions to it or borrow the methods and strategies for their own analyses.

### Open source

Open source means not making code and data publicly available but that the analysis is able to be modified by anyone. This doesn't mean that any and all modifying contributions need to be accepted, because some level of standards and quality checks need to be maintained by the owners of the analysis, but just that anyone online could propose a contribution if they wanted to.

For an analysis to be truly open source, it needs to be easily accessed by others and stored online. Code that can be emailed, for example, is not considered open source.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Reproducible parrot is reading a journal article with data and code they are interested in. The journal article says ‘Code and data are available upon request by email’. The parrot sends an email that says ‘ The email is going to an inbox with 999,999,565473 emails in it and it is labeled ‘the corresponding author’s inbox’."}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g2006b5a2e6b_0_448")
```

For reproducibility, keeping your code on GitHub is a great open source solution. It is commonly used, and has a built in system that allows others to contribute changes in a way that can be methodically reviewed by you (this is called the pull request system and we will talk about it more).

### Data is publicly available

A transparent analysis has data that is publicly shared so that others can re-run the analysis as you have. Data should be provided in a way that it can be programmatically accessed (downloaded by a script). Data also need to be well documented in the form of metadata.

<div class = "warning">
Data sharing is a critical piece for promoting the open sourceness of your analysis, however this often needs to be balanced with privacy if you work with human data or samples. These data will likely contain personal identifiable information (PII) and protected health information (PHI). For more details on this, we encourage you to see this [course about data management](https://jhudatascience.org/Ethical_Data_Handling_for_Cancer_Research/data-privacy.html).
</div>

It's imperative that you protect human data but that doesn't mean that your analysis cannot be publicly shared! These are not mutually exclusive goals, but will take a bit of thoughtful planning. In the upcoming chapters we will provide additional ideas and information for how you can conduct an open source analysis while appropriately protecting sensitive data.

### Readable code

Readable code is much more important than clever code. If you are the only one who knows what your code is doing, it will not only be difficult for other to contribute or vet your analysis, but in the future, you will probably not understand what your code is doing either.

[Read this course chapter from the ITCR training network about how to write durable code ](https://jhudatascience.org/Reproducibility_in_Cancer_Informatics/writing-durable-code.html).

### Well-documented

A well-documented analysis is a reproducible analysis. If analyses didn't require a lot of decisions and human comprehension than documentation would be unnecessary -- but also a lot of data analysts would be out of a job because robots would be able to do it! Analysts and developers often think of documentation as an after thought, but good documentation is being actively developed along with the code. Arguably, it is more important to have clear documentation than even working code, because if broken code is well documented, others may be able to help make suggestions for how it can be fixed.

Good documentation not only describes what happened in an analysis, but why it happened -- why did the analyst choose this method or parameter as opposed to others? Was there an additional analysis, literature, or other resource that led us to this conclusion? Documentation should describe not only what is happening, but the thought process that led us here.

### Version controlled

A reproducible analysis is a version controlled analysis. Analyses go through many iterations, side quests, and sometimes meet dead ends -- and this is okay, it is how data science works! -- but if not done properly with version control, can lead to an unruly code base and a lot of confused team members.

Version control helps maintain the history of your project in a way that will allow you to recover old versions if necessary, or otherwise have documented what has happened. It can also be useful for rectifying different versions of a code base between team members.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Reproducible parrot is looking at their computer with a lot of folders with different variations on similar names. The parrot asks themselves: Which is the most recent version? I wish this project had been version controlled!  "}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g201b2cf6e8c_34_370")
```

## Consistent

A reproducible analysis is consistent. It should consistently run and consistently produce the same results. It should also be written in a manner that follows a consistent style and project organization scheme.

### Re-runs consistently and easily

A reproducible analysis should be able to re-run with one command that is explicitly stated on the README. If an individual has a copy of the analysis project, it should include everything that is needed to re-run that analysis and the number of steps needed to re-run the analysis should be the lowest number possible. The more steps that are needed, the less likely it will be that someone will be able to reproduce the analysis.

This also generally means that analyses that can be performed through programmatic scripts are more reproducible than those performed by GUI's (graphic user interfaces). Most GUI's, although sometimes more intuitive to use, are unfortunately less reproducible because they require more manual steps by clicking various buttons.

### Follows a code style

Code style is important because it not only make code more readable, but it also lends a certain confidence to the reader of the code, that this code has been thought through and well kept.

### Have an organizational scheme

Project organization is a major component of reproducibility. If you are not able to find your files, then chances are individuals who are attempting to reproduce your analysis also will not be able to understand where to find things. We will discuss in a later chapter strategies for keeping projects organized, while realizing that project organization is an ongoing, iterative task.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Reproducible parrot is so happy that the analysis is well documented and organized. Parrot says This analysis is so well documented and organized! I can reproduce these analyses so easily!"}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g201b2cf6e8c_34_0")
```

## Accessible

We discussed that we use R because it is open source and free. This helps make it conducible for making reproducible analyses. Accessibility is important for reproducibility. This means minimizing the number of hoops others have to jump through to re-run your analysis.

Accessibility also involves prioritizing democratizing science over the antiquated fear that your ideas will be "scooped". We encourage you to realize that science does best when everyone has access to it and that includes code and data analyses! Making your data and code accessible, allows everyone to contribute and learn from your analysis.

Accessibility means that anyone should be able to access it -- whether or not their funding is in ample supply. So be sure to publish in journals and code repositories that do not require membership fees or any other kinds of pay walls.

```{r, fig.align='center', out.width="100%", echo = FALSE, fig.alt= "Reproducible parrot is sad because an analysis has been published behind a pay wall and has used expensive software. Reproducible parrot can not reproduce these results. "}
ottrpal::include_slide("https://docs.google.com/presentation/d/1MNHf8JpolaEP_vQ_kB-1xRBF9wo3haCArRu117hBoHA/edit#slide=id.g2006b5a2e6b_0_448")
```

Sometimes even if something is accessible in that it is "free" monetarily it doesn't mean that it is free in the sense of the amount of time it takes to get access to it. If your code and data does need some sort of controlled access features for privacy and ethical concerns of protecting data, make sure that the paperwork hoops that are put in place are truly there in the spirit of protecting the data and not merely serving to keep data and code hidden from others.



## Conclusion

In this chapter, we gave a high level overview of reproducible analyses. We discussed that reproducible analyses are transparent, consistent, and accessible. This means in practical terms, reproducible analyses:

- Are open source
- Have data that is publicly available (when appropriate)
- Emphasize readable code
- Are well documented
-
